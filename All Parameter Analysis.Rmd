---
title: "Auckland Current State Table"
author: "Paradigm Environmental"
date: "July 17, 2018"
output: html_document
---

```{r echo=FALSE, message=FALSE, warning=FALSE, include=TRUE}
#Author : Navya Mote
#Date   : 6/14/2018
#Title  : Parameter-wise Analysis
#---------------------------------------------------------------------------------------------
#Libraries
library(expss)
library(dplyr)
library(data.table)
library(openxlsx)
library(devtools)
library(roxygen2)
library(knitr)
library(DT)
library(grDevices)
#---------------------------------------------------------------------------------------------
#To set the working directory
setwd("C:/Users/PARADIGM/Desktop/Preview")
# install("Calculations") # Package for functions
#---------------------------------------------------------------------------------------------
#To read the CSV file
data <- read.csv('all_param.csv',fileEncoding="UTF-8-BOM")
grade <- read.csv('Grades.csv',fileEncoding="UTF-8-BOM")
#---------------------------------------------------------------------------------------------
#To get the list of unique parameters
df_pr<-as.character(unique(data$Parameter))
df_param<-df_pr[df_pr != ""]
# ---------------------------------------------------------------------------------------------
#Function to set a flag if "<" found
Get_Detect_lt<-function(data_input){
  data_input$Detect_count_lt<-ifelse(data_input$DetectFlag=="<", 1,0)
}
#-----------------------------------------------------------------------------------------------
#Function to set a flag if ">" found
Get_Detect_gt<-function(data_input){
  data_input$Detect_count_gt<-ifelse(data_input$DetectFlag==">", 1,0)
}
#-----------------------------------------------------------------------------------------------
#Function to get samples per year
Get_Samples_Yearly<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Samples_yearly = n())
}
#----------------------------------------------------------------------------------------------
#Function to count the detect flag set to 1 per year
Get_censored<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Censored = length(which(Detect_count_lt == 1)))
}
#---------------------------------------------------------------------------------------------
#Function to get the median value of samples per year
Get_median<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Median_yearly = round(median(Value),2))
}
#--------------------------------------------------------------------------------------------
#Function to get the max value of samples per year
Get_max<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Max_yearly = round(max(Value),2))
}
#-------------------------------------------------------------------------------------------
#Function to get the min value of samples per year
Get_min<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Min_yearly = round(min(Value),2))
}
#-------------------------------------------------------------------------------------------
#Function to get the percentage of samples exceeding 540 per year
Get_exceed_540<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Exceed_540_yearly = round(sum(Value>540)/n()*100,0))
}
#------------------------------------------------------------------------------------------
#Function to get the percentage of samples exceeding 260 per year
Get_exceed_260<-function(df_per_yr){
  df_summary <- summarize(df_per_yr, Exceed_260_yearly = round(sum(Value>260)/n()*100,0))
}
#-----------------------------------------------------------------------------------------
#Function to get the censored values for all years
Get_samples_Censored<-function(df_all_years){
  df_all_yr<-mutate(df_all_years,All_Years = sum(Samples_yearly), Censored_val = sum(Censored),
                    Censored_prct = round(Censored_val/All_Years,2)*100)
}
#------------------------------------------------------------------------------------------
#Function to get the median value for all years
Get_median_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs, Median_all_yr = round(median(Value),2))
}
#------------------------------------------------------------------------------------------
#Function to get the 95th percentile for all years
Get_Percentile_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs,
                     Percentile_all_yr = round(quantile(Value, c(.95)),2))
}
#-----------------------------------------------------------------------------------------
#Function to get the max value for all years
Get_Max_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs,
                     Max_all_yr = round(max(Value),2))
}
#-------------------------------------------------------------------------------------------
#Function to get the min value for all years
Get_Min_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs,
                     Min_all_yr = round(min(Value),2))
}
#------------------------------------------------------------------------------------------
#Function to get the percentage of samples exceeding 540
Get_Exceed_540_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs,
                     Exceed_540_all_yr = round(sum(Value>540)/n()*100,0))
}
#------------------------------------------------------------------------------------------
#Function to get the percentage of samples exceeding 260
Get_Exceed_260_all_years<-function(df_all_yrs){
  all_year <- mutate(df_all_yrs,
                     Exceed_260_all_yr = round(sum(Value>260)/n()*100,0))
}
# ----------------------------------------------------------------------------------------------
#Looping at the parameters
for (param in df_param){
  if(param!="pH")
  {
  data_input<-filter(data,Parameter == param) #To get parameter specific data
  data_grade<-filter(grade, Parameter == param)#To get parameter specific grades
  if (param=="Copper (soluble)"){
    data_input$Value=data_input$Value*1000
  }else if(param=="Copper (total)"){
    data_input$Value=data_input$Value*1000
  }else if(param=="Zinc (soluble)"){
    data_input$Value=data_input$Value*1000
  }else if(param=="Zinc (total)"){
    data_input$Value=data_input$Value*1000
  }
  # -----------------------------------------------------------------------------------------------
  # Ammonia logic to link with pH using Sample Number
  if(param=="Ammonia (total)"){
    data_ip<-filter(data,Parameter == "Ammonia (total)")
    data_ph<-filter(data,Parameter == "pH")
    data_input1<-merge(data_ip,data_ph,by = 'SampleNumber', all.SampleNumber = TRUE)
    df_uph<-data_input1[!duplicated(data_input1[1:4]),]
    df_uph$ratio<- ifelse(df_uph$Value.y>9,0.2, -0.029809630224*df_uph$Value.y^6 + 1.2641450933*df_uph$Value.y^5 - 22.08947826*df_uph$Value.y^4 + 203.57964573*df_uph$Value.y^3 - 1043.9962833*df_uph$Value.y^2 + 2825.5522036*df_uph$Value.y - 3151.0179751)
    df_uph$Concph8<-df_uph$Value.x/df_uph$ratio
    data_input<-data.frame("Watershed"=df_uph$Watershed.x,"Site"=df_uph$Site.x,"Date"=df_uph$Date.x,"Value"=df_uph$Concph8,
                           "DetectFlag"=df_uph$DetectFlag.x,"Parameter"=df_uph$Parameter.x)
  }
  # ---------------------------------------------------------------------------------------------
  #To get the date in required format
  df_date <- data.table(date = as.IDate(data_input$Date,"%m/%d/%Y"))
  #---------------------------------------------------------------------------------------------
  #To set 1 when < is present and 0 if not for DetectFlag_lt for Censored data
  data_input$Detect_count_lt<-Get_Detect_lt(data_input)
  #---------------------------------------------------------------------------------------------
  #To set 1 when > is present and 0 if not for DetectFlag_gt for Censored data
  data_input$Detect_count_gt<-Get_Detect_gt(data_input)
  #---------------------------------------------------------------------------------------------
  # For values that are "below the detection limit" (that have a "<" flag associated with the value), 
  # make the reported number ½ the value
  data_input$Value<- ifelse(data_input$Detect_count_lt == 1, data_input$Value/2, data_input$Value)
  # --------------------------------------------------------------------------------------------
  # For values that are "above the detection limit" (that have a ">" flag associated with the value), 
  # make the reported number +1 the value
  data_input$Value<- ifelse(data_input$Detect_count_gt == 1, data_input$Value+1, data_input$Value)
  # --------------------------------------------------------------------------------------------
  #To get the water year based on the range in which the date falls
  year<-substring(df_date$date,1,4)
  df_yr<-data.frame("Year"=unique(year))
  df_yr[, 1] <- as.numeric(as.character( df_yr[, 1] ))
  df_yr$ID <- seq.int(nrow(df_yr))
  #To build the range of start date and end date
  df_yr$St_yr<-paste(df_yr$Year,"01-01", sep="-")
  df_yr$ed_yr<-paste(df_yr$Year,"12-31", sep="-")
  # To build an interval for Water Year
  interval.dt <- data.table(ID = df_yr$ID, start = df_yr$St_yr, end = df_yr$ed_yr)
  findYearIndex <- function(year) {
    interval.dt[,which((interval.dt$start) <= year & year <= (interval.dt$end))]
  }
  dt <- data.table(year = df_date$date)
  dt$YearIndex <- sapply(dt$year, findYearIndex)
  data_input$Wateryear<-as.numeric(dt$YearIndex)
  data_input<-data_input[!(is.na(data_input$Wateryear) | data_input$Wateryear==""), ]
  #To assign the year range based on the Water Year  
  data_input$year <- df_yr[data_input$Wateryear,]$Year
  # ---------------------------------------------------------------------------------------------
  #To group the dataset based on Watershed and Site
  df_all_yrs<-group_by(data_input,Watershed,Site)
  #To group the dataset based on Watershed,Site and Year
  df_per_yr<-group_by(data_input,Watershed,Site,year)
  # --------------------------------------------------------------------------------------------
  # To get the yearly Samples
  df_Samples_Yearly <-Get_Samples_Yearly(df_per_yr)
  #---------------------------------------------------------------------------------------------
  # To get the yearly censored%
  df_censored <-Get_censored(df_per_yr)
  # --------------------------------------------------------------------------------------------
  # To get the yearly Median
  df_median <-Get_median(df_per_yr)
  # --------------------------------------------------------------------------------------------
  # To get sort the yearly grouped data in ascending order
  df_per_yr<-arrange(df_per_yr,Value,.by_group = TRUE)
  # --------------------------------------------------------------------------------------------
  # To get the yearly Hazen 95th Percentile
  # Hazen logic:
  df_hazen<-mutate(df_per_yr,count=n(),id = seq_along(Value),rHazen=(0.5+(0.95*count)),ri=trunc(rHazen),rf=rHazen - ri,
                   rin = trunc(rHazen)+1,r1 = ifelse(count==ri, trunc(rHazen), trunc(rHazen)),r1n = ifelse(count==rin, trunc(rHazen)+1, ifelse(count<rin,trunc(rHazen),trunc(rHazen))))
  df_haz <- data.frame("Watershed"=df_hazen[ which(df_hazen$id==df_hazen$r1),]$Watershed,"Site"=df_hazen[ which(df_hazen$id==df_hazen$r1),]$Site,
                      "year"=df_hazen[ which(df_hazen$id==df_hazen$r1),]$year,"rf"=df_hazen[ which(df_hazen$id==df_hazen$r1),]$rf,"r1"= ifelse(df_hazen[ which(df_hazen$id==df_hazen$r1),]$count>=10,df_hazen[ which(df_hazen$id==df_hazen$r1),]$Value,0),
                      "r1n"= ifelse(df_hazen[ which(df_hazen$id==df_hazen$r1),]$count>=10,df_hazen[ which(df_hazen$id==df_hazen$r1n),]$Value,0)) 
  df_haz$rhazen<-((1-df_haz$rf)*df_haz$r1)+(df_haz$rf*df_haz$r1n)
  # --------------------------------------------------------------------------------------------
  # To get the yearly Max
  df_max_yearly<-Get_max(df_per_yr)
  # --------------------------------------------------------------------------------------------
  # To get the yearly Min
  df_min_yearly<-Get_min(df_per_yr)
  # --------------------------------------------------------------------------------------------
  # To place all the yearly values in the Summary dataframe
  df_summary<-data.frame("Watershed"=df_Samples_Yearly$Watershed,"Site"=df_Samples_Yearly$Site,"Samples_yearly"=df_Samples_Yearly$Samples_yearly,
                         "Censored"=df_censored$Censored,"Median_yearly"=df_median$Median_yearly,"Percentile_Yearly"=round(df_haz$rhazen,2),
                         "Max_Yearly"=df_max_yearly$Max_yearly,"Min_Yearly"=df_min_yearly$Min_yearly, "WaterYear"=df_Samples_Yearly$year)
  # --------------------------------------------------------------------------------------------
  if(param=="E.coli"){
    #To get the yearly 540 cfu / 100 mL exceedances
    df_exceed_540_yearly<-Get_exceed_540(df_per_yr)
    # --------------------------------------------------------------------------------------------
    #To get the yearly 260 cfu / 100 mL exceedances
    df_exceed_260_yearly<-Get_exceed_260(df_per_yr)
    # --------------------------------------------------------------------------------------------
    df_summary$Exceed_540<-df_exceed_540_yearly$Exceed_540_yearly
    df_summary$Exceed_260<-df_exceed_260_yearly$Exceed_260_yearly
  }
  # ----------------------------------------------------------------------------------------------
  # To group the summary table w.r.t Watershed and Site
  df_all_years<-group_by(df_summary, Watershed, Site)
  # ---------------------------------------------------------------------------------------------
  # To get the all year Censored%
  df_samples_Censored<-Get_samples_Censored(df_all_years)
  # ---------------------------------------------------------------------------------------------
  # To get the all year samples 
  df_summary$Samples_All_Years<-df_samples_Censored$All_Years
  # ----------------------------------------------------------------------------------------------
  # To get the all year Median
  df_median_all_years<-Get_median_all_years(df_all_yrs)
  # ----------------------------------------------------------------------------------------------
  # To get the all year Max
  df_Max_all_years<-Get_Max_all_years(df_all_yrs)
  # ----------------------------------------------------------------------------------------------
  # To get the all year Min
  df_Min_all_years<-Get_Min_all_years(df_all_yrs)
  # ---------------------------------------------------------------------------------------------
  # To get the all year Hazen 95th Percentile
  df_all_yrs<-arrange(df_all_yrs,Value,.by_group = TRUE)
  df_hazen1<-mutate(df_all_yrs,count=n(),id = seq_along(Value),rHazen=(0.5+(0.95*count)),ri=trunc(rHazen),rf=rHazen - ri,
                    rin = trunc(rHazen)+1)
  df_haz1 <- data.frame("Watershed"=df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$Watershed,"Site"=df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$Site,
                       "year"=df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$year,"rf"=df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$rf,"r1"= ifelse(df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$count>=10,df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$Value,0),
                       "r1n"= ifelse(df_hazen1[ which(df_hazen1$id==df_hazen1$ri),]$count>=10,df_hazen1[ which(df_hazen1$id==df_hazen1$rin),]$Value,0)) 
  df_haz1$rhazen<-round((((1-df_haz1$rf)*df_haz1$r1)+(df_haz1$rf*df_haz1$r1n)),2)
  df_haz1<-df_haz1[rep(seq_len(nrow(df_haz1)), each=nrow(df_haz1)),]
  # -----------------------------------------------------------------------------------------------
  df_summary$Censored = df_samples_Censored$Censored_prct
  if(param=="E.coli"){
    # ---------------------------------------------------------------------------------------------
    # To get the all year 540 cfu / 100 mL exceedances
    df_Exceed_540_all_years<-Get_Exceed_540_all_years(df_all_yrs)
    # --------------------------------------------------------------------------------------------
    # To get the all year 260 cfu / 100 mL exceedances
    df_Exceed_260_all_years<-Get_Exceed_260_all_years(df_all_yrs)
    df_w_s_y<-data.frame("Watershed"=df_Exceed_540_all_years$Watershed,"Site"=df_Exceed_540_all_years$Site, "year"=df_Exceed_540_all_years$year, "Median_all_yr"=df_median_all_years$Median_all_yr,
                          "Exceed_540_all_yr"=df_Exceed_540_all_years$Exceed_540_all_yr, "Exceed_260_all_yr"=df_Exceed_260_all_years$Exceed_260_all_yr)
  }else{
    df_w_s_y<-data.frame("Watershed"=df_Max_all_years$Watershed,"Site"=df_Max_all_years$Site, "year"=df_Max_all_years$year, "Median_all_yr"=df_median_all_years$Median_all_yr, "Max_all_yr"=df_Max_all_years$Max_all_yr, "Min_all_yr"=df_Min_all_years$Min_all_yr)
  }
  
  #To get the unique values with no duplicates
  df_uwsy<-unique(df_w_s_y,nomatch = 0)
  #To sort the data w.r.t Watersheds in ascending order
  df_uwsy<-df_uwsy[order(df_uwsy$Watershed),]
  #To get the unique functions(Median, Percentile, Max, Min, Exceed 260, Exceed 540)
  df_function<-as.character(unique(data_grade$Function))
  df_function<-df_function[df_function != ""]
  #Looping at the functions to get the grades
  for(func in df_function){
    # --------------------------------------------------------------------------------------------------------
    # To get the Median attribute state yearly and all years
    if(func == "Median")
      {
        Gr_median = filter(data_grade, Function == func)
        interval.gr <- data.table(Grade = Gr_median$Grade, gt = Gr_median$gt, lt = Gr_median$lt)
        findIndex <- function(Median_yearly) 
          {
            interval.gr[,which((interval.gr$gt) < Median_yearly & Median_yearly <= (interval.gr$lt))]
          }
        df_summary$Index <- sapply(df_summary$Median_yearly, findIndex)
        df_summary$Median_Attr_state_yearly <- Gr_median[df_summary$Index,]$Grade
        findIndex1 <- function(Median_all_yr) 
        {
          interval.gr[,which((interval.gr$gt) < Median_all_yr & Median_all_yr <= (interval.gr$lt))]
        }
        df_summary$Index1 <- sapply(df_uwsy$Median_all_yr, findIndex1)
        df_summary$Median_Attr_state_all_years <- Gr_median[df_summary$Index1,]$Grade
        
        df_summary$Med_val<-ifelse(df_summary$Median_Attr_state_all_years=="A",1,
                                    ifelse(df_summary$Median_Attr_state_all_years=="B",2,
                                           ifelse(df_summary$Median_Attr_state_all_years=="C",3,
                                                  ifelse(df_summary$Median_Attr_state_all_years=="D",4,
                                                         ifelse(df_summary$Median_Attr_state_all_years=="E",5,"NA")))))
        df_summary$Median_All_Years<-df_uwsy$Median_all_yr
    }
    # -----------------------------------------------------------------------------------------------------------
    # To get the Percentile attribute state yearly and all years
    else if(func == "Percentile")
      {
        Gr_per = filter(data_grade, Function == func)
        interval.gr <- data.table(Grade = Gr_per$Grade, gt = Gr_per$gt, lt = Gr_per$lt)
        findIndex <- function(Percentile_Yearly) 
          {
            interval.gr[,which((interval.gr$gt) < Percentile_Yearly & Percentile_Yearly <= (interval.gr$lt))]
          }
        df_summary$Index2 <- sapply(df_summary$Percentile_Yearly, findIndex)
        df_summary$Percentile_Attr_state_yearly <- Gr_per[df_summary$Index2,]$Grade
        findIndex1 <- function(rhazen) 
        {
          interval.gr[,which((interval.gr$gt) < rhazen & rhazen <= (interval.gr$lt))]
        }
        df_summary$Index3 <- sapply(df_haz1$rhazen, findIndex1)
        df_summary$Percentile_Attr_state_all_years <- Gr_per[df_summary$Index3,]$Grade
        
        df_summary$Per_val<-ifelse(df_summary$Percentile_Attr_state_all_years=="A",1,
                                    ifelse(df_summary$Percentile_Attr_state_all_years=="B",2,
                                           ifelse(df_summary$Percentile_Attr_state_all_years=="C",3,
                                                  ifelse(df_summary$Percentile_Attr_state_all_years=="D",4,
                                                         ifelse(df_summary$Percentile_Attr_state_all_years=="E",5,"NA")))))
        if(param=="E.coli"){
          df_summary$Percentile_All_Years=round(df_haz1$rhazen,0)
          df_summary$Percentile_Yearly<-ifelse(df_summary$Percentile_Yearly==0,"NA",round(as.numeric(df_summary$Percentile_Yearly),0))
        }else{
          df_summary$Percentile_All_Years=round(df_haz1$rhazen,2)
          df_summary$Percentile_Yearly<-ifelse(df_summary$Percentile_Yearly==0,"NA",round(as.numeric(df_summary$Percentile_Yearly),2))
        }
        df_summary$Percentile_Attr_state_yearly<-ifelse(df_summary$Percentile_Yearly=="NA","NA",as.character(df_summary$Percentile_Attr_state_yearly))
    }
    # ------------------------------------------------------------------------------------------------------------
    # To get the Min attribute state yearly and all years
    else if(func == "Min")
    {
      Gr_min = filter(data_grade, Function == func)
      interval.gr <- data.table(Grade = Gr_min$Grade, gt = Gr_min$gt, lt = Gr_min$lt)
      findIndex <- function(Min_Yearly)
      {
        interval.gr[,which((interval.gr$gt) <= Min_Yearly & Min_Yearly < (interval.gr$lt))]
      }
      df_summary$Index4 <- sapply(df_summary$Min_Yearly, findIndex)
      df_summary$Min_Attr_state_yearly <- Gr_min[df_summary$Index4,]$Grade
      findIndex1 <- function(Min_all_yr)
      {
        interval.gr[,which((interval.gr$gt) < Min_all_yr & Min_all_yr <= (interval.gr$lt))]
      }
      df_summary$Index5 <- sapply(df_uwsy$Min_all_yr, findIndex1)
      df_summary$Min_Attr_state_all_years <- Gr_min[df_summary$Index5,]$Grade
      df_summary$Min_All_Years<-df_uwsy$Min_all_yr
    }
    # -----------------------------------------------------------------------------------------------------------
    # To get the Max attribute state yearly and all years
    else if(func == "Max")
    {
      Gr_max = filter(data_grade, Function == func)
      interval.gr <- data.table(Grade = Gr_max$Grade, gt = Gr_max$gt, lt = Gr_max$lt)
      findIndex <- function(Max_Yearly) 
      {
        interval.gr[,which((interval.gr$gt) < Max_Yearly & Max_Yearly <= (interval.gr$lt))]
      }
      df_summary$Index6 <- sapply(df_summary$Max_Yearly, findIndex)
      df_summary$Max_Attr_state_yearly <- Gr_max[df_summary$Index6,]$Grade
      findIndex1 <- function(Max_all_yr) 
      {
        interval.gr[,which((interval.gr$gt) < Max_all_yr & Max_all_yr <= (interval.gr$lt))]
      }
      df_summary$Index7 <- sapply(df_uwsy$Max_all_yr, findIndex1)
      df_summary$Max_Attr_state_all_years <- Gr_max[df_summary$Index7,]$Grade
      
      df_summary$Max_value<-ifelse(df_summary$Max_Attr_state_all_years=="A",1,
                                    ifelse(df_summary$Max_Attr_state_all_years=="B",2,
                                           ifelse(df_summary$Max_Attr_state_all_years=="C",3,
                                                  ifelse(df_summary$Max_Attr_state_all_years=="D",4,"NA"))))
      df_summary$Max_All_Years<-df_uwsy$Max_all_yr
      
    }
    # ------------------------------------------------------------------------------------------------------------------
    # # To get the 260 cfu / 100 mL exceedances attribute state yearly and all years
    else if(func == "Exceed_260")
    {
      Gr_260 = filter(data_grade, Function == func)
      interval.gr <- data.table(Grade = Gr_260$Grade, gt = Gr_260$gt, lt = Gr_260$lt)
      findIndex <- function(Exceed_260) 
      {
        interval.gr[,which((interval.gr$gt) < Exceed_260 & Exceed_260 <= (interval.gr$lt))]
      }
      df_summary$Index8 <- sapply(df_summary$Exceed_260, findIndex)
      df_summary$Exceed_260_Attribute_state_yearly <- Gr_260[df_summary$Index8,]$Grade
      findIndex1 <- function(Exceed_260_all_yr) 
      {
        interval.gr[,which((interval.gr$gt) < Exceed_260_all_yr & Exceed_260_all_yr <= (interval.gr$lt))]
      }
      df_summary$Index9 <- sapply(df_uwsy$Exceed_260_all_yr, findIndex1)
      df_summary$Exceed_260_Attr_state_all_years <- Gr_260[df_summary$Index9,]$Grade
      
      df_summary$ex260_val<-ifelse(df_summary$Exceed_260_Attr_state_all_years=="A",1,
                                    ifelse(df_summary$Exceed_260_Attr_state_all_years=="B",2,
                                           ifelse(df_summary$Exceed_260_Attr_state_all_years=="C",3,
                                                  ifelse(df_summary$Exceed_260_Attr_state_all_years=="D",4,
                                                         ifelse(df_summary$Exceed_260_Attr_state_all_years=="E",5,
                                                                "NA")))))
      df_summary$Exceed_260_All_Years<-df_uwsy$Exceed_260_all_yr
    }
    # ----------------------------------------------------------------------------------------------------------------
    # To get the 540 cfu / 100 mL exceedances attribute state yearly and all years
    else if(func == "Exceed_540")
    {
      Gr_540 = filter(data_grade, Function == func)
      interval.gr <- data.table(Grade = Gr_540$Grade, gt = Gr_540$gt, lt = Gr_540$lt)
      findIndex <- function(Exceed_540) 
      {
        interval.gr[,which((interval.gr$gt) < Exceed_540 & Exceed_540 <= (interval.gr$lt))]
      }
      df_summary$Index11 <- sapply(df_summary$Exceed_540, findIndex)
      df_summary$Exceed_540_Attribute_state_yearly <- Gr_540[df_summary$Index11,]$Grade
      findIndex1 <- function(Exceed_540_all_yr) 
      {
        interval.gr[,which((interval.gr$gt) < Exceed_540_all_yr & Exceed_540_all_yr <= (interval.gr$lt))]
      }
      df_summary$Index12 <- sapply(df_uwsy$Exceed_540_all_yr, findIndex1)
      df_summary$Exceed_540_Attr_state_all_years <- Gr_540[df_summary$Index12,]$Grade
      
      df_summary$ex540_val<-ifelse(df_summary$Exceed_540_Attr_state_all_years=="A",1,
                                    ifelse(df_summary$Exceed_540_Attr_state_all_years=="B",2,
                                           ifelse(df_summary$Exceed_540_Attr_state_all_years=="C",3,
                                                  ifelse(df_summary$Exceed_540_Attr_state_all_years=="D",4,
                                                         ifelse(df_summary$Exceed_540_Attr_state_all_years=="E",5,
                                                                "NA")))))
      df_summary$Exceed_540_All_Years<-df_uwsy$Exceed_540_all_yr
    }
    # -------------------------------------------------------------------------------------------------------------
  }
  # ---------------------------------------------------------------------------------------------------------------
  # To get the overall attribute state for all parameters
  if (param=="Ammonia (total)"){
    df_max<-data.frame(df_summary$Med_val,df_summary$Max_value)
    df_summary$Max_val<-apply(X=df_max, MARGIN=1, FUN=max)
  }else if(param=="E.coli"){
    df_max<-data.frame(df_summary$Med_val,df_summary$ex540_val, df_summary$ex260_val, df_summary$Per_val)
    df_summary$Max_val<-apply(X=df_max, MARGIN=1, FUN=max)
  }else{
    if(param != "DO"){
      df_max<-data.frame(df_summary$Med_val,df_summary$Per_val)
      df_summary$Max_val<-apply(X=df_max, MARGIN=1, FUN=max)
  }
  }
  if(param != "DO"){
    df_summary$Overall_Attribute_State<-ifelse(df_summary$Max_val==1,"A",
                                                ifelse(df_summary$Max_val==2,"B",
                                                       ifelse(df_summary$Max_val==3,"C",
                                                              ifelse(df_summary$Max_val==4,"D",
                                                                     ifelse(df_summary$Max_val==5,"E",
                                                                            "NA")))))
  }
  # --------------------------------------------------------------------------------------------------------
  # To place the parameters into separate dataframes
  if (param=="Total Oxidized Nitrogen"){
    df_ton<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                   Percentile_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="Ammonia (total)"){
    df_amm<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Max_Yearly, Max_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Max_Attr_state_yearly,
                   Max_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="DO"){
    df_do<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                  Min_Yearly, Min_All_Years,
                  Min_Attr_state_yearly,Min_Attr_state_all_years)
  }else if(param=="Copper (soluble)"){
    df_cus<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                   Percentile_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="Copper (total)"){
    df_cut<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                   Percentile_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="Zinc (soluble)"){
    df_zns<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                   Percentile_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="Zinc (total)"){
    df_znt<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                   Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                   Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                   Percentile_Attr_state_all_years,Overall_Attribute_State)
  }else if(param=="E.coli"){
      df_ecoli<-select(df_summary, Watershed, Site, WaterYear, Samples_yearly, Samples_All_Years, Censored,
                     Exceed_540, Exceed_260, Exceed_540_All_Years, Exceed_260_All_Years,
                     Median_yearly, Median_All_Years, Percentile_Yearly, Percentile_All_Years,
                     Exceed_540_Attribute_state_yearly, Exceed_540_Attr_state_all_years,
                     Exceed_260_Attribute_state_yearly, Exceed_260_Attr_state_all_years,
                     Median_Attr_state_yearly,Median_Attr_state_all_years, Percentile_Attr_state_yearly,
                     Percentile_Attr_state_all_years,Overall_Attribute_State)
      

  }
  }
  # -----------------------------------------------------------------------------------------------------------
}
#Uncomment to write parameters to separate tabs in an excel file as output
# l <- list("TON" = df_ton, "Ammonia (total)" = df_amm, "DO" = df_do, "Copper (soluble)" = df_cus,
#           "Copper (total)" = df_cut, "Zinc (soluble)" = df_zns, "Zinc (total)" = df_znt, "E.coli" = df_ecoli)
# write.xlsx(l, file = "Parameter_Grades_Analysis.xlsx")
# -------------------------------------------------------------------------------------------------------------
# To place TON into html datatable
datatable(df_ton,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 1: Total Oxidized Nitrogen'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_ton$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_ton$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))
# --------------------------------------------------------------------------------------------------------------------------
# To place Ammonia into html datatable 
datatable(df_amm,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;','Table 2: Ammonia (total)'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "Max per year","Max all years",'Median per year A.S.', 'Median all years A.S.', "Max per year A.S.", "Max all years A.S. A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_amm$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_amm$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Max_Yearly',
    background = styleColorBar(df_amm$Max_Yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Max_All_Years',
    background = styleColorBar(df_amm$Max_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Max_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Max_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))
# --------------------------------------------------------------------------------------------------------------------
# To place DO into a html datatable
datatable(df_do,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 3: DO'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Min per year', 'Min all years', 'Min per year A.S.', 'Min all years A.S.'))%>% formatStyle(
  'Min_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise'))
)
# --------------------------------------------------------------------------------------------------------------------
# To place Copper(Soluble) into a html datatable
datatable(df_cus,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 4: Copper (soluble)'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_cus$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_cus$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))

# ----------------------------------------------------------------------------------------------------------------------
# To place Copper(Total) into a html datatable
datatable(df_cut,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 5: Copper (total)'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_cut$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_cut$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))
# --------------------------------------------------------------------------------------------------------------------
# To place Zinc(Soluble) into a html datatable
datatable(df_zns,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 6: Zinc (soluble)'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_zns$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_zns$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))
# ----------------------------------------------------------------------------------------------------------------
# To place Zinc(total) into a html datatable
as.datatable_widget(df_znt,style="bootstrap",
                          caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 7: Zinc(Total)'),
                          colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', 'Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_znt$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_znt$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D"), c('snow','lightcyan','paleturquoise','darkturquoise')))
# ----------------------------------------------------------------------------------------------------------------
# To place E.Coli into a html datatable
datatable(df_ecoli,style="bootstrap",
                # style = 'caption-side: top; text-align: center;',
                caption = htmltools::tags$caption(style = 'text-align: left; color:black; font-size: 20px;', 'Table 8: E.Coli'),
                colnames = c('Site ID', 'Site', 'Year', 'Yearly Samples', 'Samples All Years', 'Censored', '% Exceeding 540 per year', '% Exceeding 260 per year','% Exceeding 540 all years', '% Exceeding 260 all years','Median per year', 'Median all years', "95th Percentile per year","95th Percentile all years",'% Exceeding 540 per year A.S.', '% Exceeding 260 per year A.S.', '% Exceeding 540 all years A.S.', '% Exceeding 260 all years A.S.','Median per year A.S.', 'Median all years A.S.', "95th Percentile per year A.S.", "95th Percentile all years A.S.",'Overall Attribute State'))%>%
  formatStyle(
    'Exceed_540',
    background = styleColorBar(df_ecoli$Exceed_540, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Exceed_260',
    background = styleColorBar(df_ecoli$Exceed_260, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Exceed_540_All_Years',
    background = styleColorBar(df_ecoli$Exceed_540_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Exceed_260_All_Years',
    background = styleColorBar(df_ecoli$Exceed_260_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_yearly',
    background = styleColorBar(df_ecoli$Median_yearly, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>%
  formatStyle(
    'Median_All_Years',
    background = styleColorBar(df_ecoli$Median_All_Years, 'darkturquoise'),
    backgroundSize = '100% 90%',
    backgroundRepeat = 'no-repeat',
    backgroundPosition = 'center'
  )%>% formatStyle(
  'Overall_Attribute_State',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Exceed_540_Attribute_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Exceed_540_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Exceed_260_Attribute_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Exceed_260_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Median_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Median_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Percentile_Attr_state_yearly',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))%>% formatStyle(
  'Percentile_Attr_state_all_years',
  target = 'cell',
  backgroundColor = styleEqual(c("A","B","C","D","E"), c('snow','lightcyan','paleturquoise','darkturquoise','lightseagreen')))
```

